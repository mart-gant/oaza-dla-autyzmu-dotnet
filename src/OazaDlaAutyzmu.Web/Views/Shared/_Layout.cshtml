<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Oaza dla Autyzmu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <a href="#mainContent" class="skip-link">Przejdź do treści głównej</a>
    <header class="bg-white dark:bg-gray-800 shadow-md">
        <nav class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a asp-controller="Home" asp-action="Index" class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">
                    🧩 Oaza dla Autyzmu
                </a>
                
                <div class="hidden md:flex space-x-6">
                    <a asp-controller="Home" asp-action="Index" 
                       class="text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition">
                        Strona główna
                    </a>
                    <a asp-controller="Facilities" asp-action="Index" 
                       class="text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition">
                        Placówki
                    </a>
                    <a asp-controller="Forum" asp-action="Index" 
                       class="text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition">
                        Forum
                    </a>
                    <a asp-controller="Home" asp-action="Privacy" 
                       class="text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition">
                        Artykuły
                    </a>
                </div>

                <div class="flex items-center space-x-2 md:space-x-4">
                    <!-- Accessibility Controls -->
                    <details class="relative hidden md:block">
                        <summary class="cursor-pointer px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            Dostępność
                        </summary>
                        <div class="absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 z-50" role="group" aria-label="Ustawienia dostępności">
                            <div class="space-y-3 text-sm">
                                <label class="flex items-center justify-between">
                                    <span class="text-gray-700 dark:text-gray-300">Wysoki kontrast</span>
                                    <input type="checkbox" id="highContrastToggle" class="h-4 w-4" aria-label="Włącz wysoki kontrast">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-gray-700 dark:text-gray-300">Większy tekst</span>
                                    <input type="checkbox" id="fontSizeToggle" class="h-4 w-4" aria-label="Włącz większy tekst">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-gray-700 dark:text-gray-300">Mniej ruchu</span>
                                    <input type="checkbox" id="reducedMotionToggle" class="h-4 w-4" aria-label="Włącz ograniczenie ruchu">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-gray-700 dark:text-gray-300">Tryb spokojny</span>
                                    <input type="checkbox" id="calmModeToggle" class="h-4 w-4" aria-label="Włącz tryb spokojny">
                                </label>
                            </div>
                        </div>
                    </details>

                    <!-- Dark Mode Toggle -->
                    <label for="darkModeToggle" class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="darkModeToggle" class="sr-only peer" aria-label="Przełącz tryb ciemny">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"></div>
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">🌙</span>
                    </label>

                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <!-- Notifications Bell -->
                        <a asp-controller="Notifications" asp-action="Index" class="relative text-gray-700 dark:text-gray-300 hover:text-indigo-600">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                            </svg>
                            <span id="notification-badge" class="hidden absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-600 rounded-full"></span>
                        </a>

                        @if (User.IsInRole("Admin"))
                        {
                            <a asp-controller="Admin" asp-action="Dashboard" 
                               class="hidden md:inline-block px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition text-sm font-medium">
                                Panel Admin
                            </a>
                        }
                        @if (User.IsInRole("Moderator") || User.IsInRole("Admin"))
                        {
                            <a asp-controller="Moderator" asp-action="PendingReviews" 
                               class="hidden md:inline-block px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition text-sm font-medium">
                                Moderacja
                            </a>
                        }
                        <span class="hidden md:inline text-gray-700 dark:text-gray-300">
                            Witaj, @User.Identity.Name!
                        </span>
                        <form asp-controller="Account" asp-action="Logout" method="post" class="hidden md:inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition">
                                Wyloguj
                            </button>
                        </form>
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" 
                           class="hidden md:inline-block px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition">
                            Zaloguj się
                        </a>
                    }

                    <!-- Mobile Menu Button -->
                    <button id="mobileMenuButton" class="md:hidden p-2 text-gray-700 dark:text-gray-300" aria-label="Otwórz menu" aria-expanded="false" aria-controls="mobileMenu">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4 space-y-2">
                <div class="px-4 py-2 border border-gray-200 dark:border-gray-700 rounded bg-gray-50 dark:bg-gray-900" role="group" aria-label="Ustawienia dostępności">
                    <p class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2">Dostępność</p>
                    <div class="space-y-2 text-sm">
                        <label class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Wysoki kontrast</span>
                            <input type="checkbox" id="highContrastToggleMobile" class="h-4 w-4" aria-label="Włącz wysoki kontrast">
                        </label>
                        <label class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Większy tekst</span>
                            <input type="checkbox" id="fontSizeToggleMobile" class="h-4 w-4" aria-label="Włącz większy tekst">
                        </label>
                        <label class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Mniej ruchu</span>
                            <input type="checkbox" id="reducedMotionToggleMobile" class="h-4 w-4" aria-label="Włącz ograniczenie ruchu">
                        </label>
                        <label class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Tryb spokojny</span>
                            <input type="checkbox" id="calmModeToggleMobile" class="h-4 w-4" aria-label="Włącz tryb spokojny">
                        </label>
                    </div>
                </div>
                <a asp-controller="Home" asp-action="Index" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                    Strona główna
                </a>
                <a asp-controller="Facilities" asp-action="Index" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                    Placówki
                </a>
                <a asp-controller="Forum" asp-action="Index" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                    Forum
                </a>
                <a asp-controller="Home" asp-action="Privacy" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                    Artykuły
                </a>
                @if (User.Identity?.IsAuthenticated == true)
                {
                    @if (User.IsInRole("Admin"))
                    {
                        <a asp-controller="Admin" asp-action="Dashboard" class="block px-4 py-2 bg-purple-600 text-white rounded">
                            Panel Admin
                        </a>
                    }
                    @if (User.IsInRole("Moderator") || User.IsInRole("Admin"))
                    {
                        <a asp-controller="Moderator" asp-action="PendingReviews" class="block px-4 py-2 bg-blue-600 text-white rounded">
                            Moderacja
                        </a>
                    }
                    <form asp-controller="Account" asp-action="Logout" method="post" class="px-4">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded">
                            Wyloguj (@User.Identity.Name)
                        </button>
                    </form>
                }
                else
                {
                    <a asp-controller="Account" asp-action="Login" class="block px-4 py-2 bg-indigo-600 text-white rounded">
                        Zaloguj się
                    </a>
                }
            </div>
        </nav>
    </header>
    
    <main id="mainContent" class="min-h-screen">
        @RenderBody()
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">🧩 Oaza dla Autyzmu</h3>
                    <p class="text-gray-400">
                        Platforma wsparcia dla osób z autyzmem i ich rodzin.
                    </p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Linki</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a asp-controller="Facilities" asp-action="Index" class="hover:text-white transition">Placówki</a></li>
                        <li><a asp-controller="Forum" asp-action="Index" class="hover:text-white transition">Forum</a></li>
                        <li><a asp-controller="Home" asp-action="Privacy" class="hover:text-white transition">Artykuły</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">Kontakt</h4>
                    <p class="text-gray-400">
                        Email: kontakt@oazadlaautyzmu.pl<br />
                        Tel: +48 123 456 789
                    </p>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                &copy; @DateTime.Now.Year Oaza dla Autyzmu - <a asp-controller="Home" asp-action="Privacy" class="hover:text-white transition">Polityka prywatności</a>
            </div>
        </div>
    </footer>

    <!-- Cookie Consent Banner (GDPR) -->
    <div id="cookieConsent" class="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 shadow-lg z-50" style="display:none;">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="text-sm">
                <p>
                    Ta strona używa plików cookie, aby zapewnić najlepszą jakość usług. 
                    Korzystając z tej strony, wyrażasz zgodę na używanie cookies zgodnie z naszą 
                    <a asp-controller="Home" asp-action="Privacy" class="underline hover:text-indigo-300">Polityką Prywatności</a>.
                </p>
            </div>
            <div class="flex gap-2">
                <button onclick="acceptCookies()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded text-sm font-medium">
                    Akceptuję
                </button>
                <button onclick="declineCookies()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-sm font-medium">
                    Odrzuć
                </button>
            </div>
        </div>
    </div>

    <script>
        // Cookie consent functionality
        window.addEventListener('load', function() {
            if (!localStorage.getItem('cookieConsent')) {
                document.getElementById('cookieConsent').style.display = 'block';
            }
        });

        function acceptCookies() {
            localStorage.setItem('cookieConsent', 'accepted');
            document.getElementById('cookieConsent').style.display = 'none';
        }

        function declineCookies() {
            localStorage.setItem('cookieConsent', 'declined');
            document.getElementById('cookieConsent').style.display = 'none';
        }

        // Notification badge update
        @if (User.Identity?.IsAuthenticated == true)
        {
            <text>
            function updateNotificationBadge() {
                fetch('/Notifications/GetUnreadCount')
                    .then(response => response.json())
                    .then(data => {
                        const badge = document.getElementById('notification-badge');
                        if (badge) {
                            if (data.count > 0) {
                                badge.textContent = data.count > 99 ? '99+' : data.count;
                                badge.classList.remove('hidden');
                            } else {
                                badge.classList.add('hidden');
                            }
                        }
                    })
                    .catch(error => console.error('Error fetching notification count:', error));
            }

            // Update badge on page load
            window.addEventListener('load', updateNotificationBadge);

            // Update badge every 30 seconds
            setInterval(updateNotificationBadge, 30000);
            </text>
        }
    </script>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
